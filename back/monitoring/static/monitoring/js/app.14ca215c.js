(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{14:function(module,__webpack_exports__,__webpack_require__){"use strict";var redux__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(7),appSettings=function appSettings(){var state=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},action=arguments[1];switch(action.type){case"settings":var data=action.data;for(var key in data.group){var value=data.group[key].value,dataType=data.group[key].datatype__type;switch(dataType){case"integer":value=+value;break;case"js_function":value=eval("("+value+")");break;default:value=value.toString()}data.group[key]=value}return action.data;default:return state}},reducers=Object(redux__WEBPACK_IMPORTED_MODULE_0__.b)({appSettings:appSettings}),store=Object(redux__WEBPACK_IMPORTED_MODULE_0__.c)(reducers);__webpack_exports__.a=store},28:function(t,e,a){a(29),t.exports=a(62)},62:function(t,e,a){"use strict";a.r(e);var n=a(0),r=a.n(n),i=a(23),s=a(67),o=a(65),l=a(66),c=a(6),u=a(14),p=a(25),d=a.n(p),m=location.protocol+"//"+location.host,h={get:function(t){return this._axios("GET",t)},post:function(t){return this._axios("POST",t)},_axios:function(t,e){d()({method:t,baseUrl:m,url:e.url,params:"GET"===t?e.data||{}:null,data:"POST"===t?e.data||{}:null}).then(function(t){if("function"==typeof e.success)return e.success(t)}).catch(function(t){if("function"==typeof e.error)return e.error(t)})},getUrlParams:function(t){var e=new URL(location.href).searchParams.get(t);return void 0===e?null:e},getCookie:function(t,e){if(!window.localStorage)return null;var a=window.localStorage.getItem(t);return null===a?e:a=JSON.parse(window.localStorage.getItem(t))},setCookie:function(t,e){if(!window.localStorage)return null;window.localStorage.setItem(t,JSON.stringify(e))},arrayIndex:function(t,e){var a=e.indexOf(t);return-1!==e.indexOf(t)?a:null},arrayUnset:function(t,e){var a=this.arrayIndex(t,e);a&&e.splice(a,1)},numberFormat:function(t,e,a,n){t=(t+"").replace(/[^0-9+\-Ee.]/g,"");var r=isFinite(+t)?+t:0,i=isFinite(+e)?Math.abs(e):0,s=void 0===n?",":n,o=void 0===a?".":a;toFixedLength(function(t,e){var a=Math.pow(10,e);return""+Math.round(t*a)/a});var l=(i?toFixedLength(r,i):""+Math.round(r)).split(".");return l[0].length>3&&(l[0]=l[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,s)),(l[1]||"").length<i&&(l[1]=l[1]||"",l[1]+=new Array(i-l[1].length+1).join("0")),l.join(o)}},f=a(64);var v=function(t){function e(a){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,a));return n.handleInputChange=n.handleInputChange.bind(n),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.handleInputChange=function(t){var e=t.target.value;this.props.onChange(e),t.preventDefault()},e.prototype.render=function(){var t=[];for(var e in this.props.list)t.push(r.a.createElement("option",{key:e,value:this.props.list[e].id},this.props.list[e].name));return r.a.createElement("div",null,this.props.label&&r.a.createElement("label",null,this.props.label),r.a.createElement("select",{className:this.props.className,onChange:this.handleInputChange,style:this.props.style},t))},e}(r.a.Component);v.defaultProps={className:"form-control",list:[],label:null,style:{},onChange:function(t){return t}};var b=v;var E=function(t){function e(a){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,a))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.render=function(){var t=[];for(var e in this.props.buttons){var a="";this.props.buttons[e].ico&&(a=r.a.createElement("i",{className:"c-blue-500 "+this.props.buttons[e].ico})),t.push(r.a.createElement("button",{key:e,title:this.props.buttons[e].title,onClick:this.props.buttons[e].onClick,className:"btn btn-outline-primary btn-sm"},a,this.props.buttons[e].caption))}return r.a.createElement("div",{className:this.props.col},r.a.createElement("div",{className:"bgc-white bd bdrs-3 p-20 mB-20"},r.a.createElement("div",null,this.props.title&&r.a.createElement("h6",{className:"c-grey-900 float-left"},this.props.title),r.a.createElement("div",{className:"float-right"},t)),r.a.createElement("div",{className:"mT-30"},this.props.children)))},e}(r.a.Component);E.defaultProps={title:"",buttons:"",col:""};var y=E;var g=r.a.createElement("i",{className:"ti-light-bulb"}),_=r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",{width:"40px"}),r.a.createElement("th",null,"Наименование"),r.a.createElement("th",null,"Адрес"),r.a.createElement("th",{width:"95px"},"Темп.",r.a.createElement("br",null),"среды"),r.a.createElement("th",{width:"95px"},"Темп.",r.a.createElement("br",null),"CPU"),r.a.createElement("th",{width:"90px"}))),w=function(t){function e(a){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,a));return n.state={data:{},clientId:4,timer:null},n.handleChange=n.handleChange.bind(n),n.updateList=n.updateList.bind(n),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.componentDidMount=function(){this.updateList();var t=setInterval(this.updateList,updateInterval);this.setState({timer:t})},e.prototype.componentWillUnmount=function(){clearTimeout(this.state.timer),this.setState({timer:null})},e.prototype.handleChange=function(t,e){var a;this.setState(((a={})[t]=e,a))},e.prototype.updateList=function(){var t=this;h.get({url:"/monitoring/api",data:{action:"devices",client_id:this.state.clientId},success:function(e){t.setState({data:e.data})}})},e.prototype.render=function(){var t=[];if("data"in this.state.data){var e=this.state.data.data;for(var a in e){var n=null,i={cpu:null,ext:null},s=[],o=[],l=[];if("self"in e[a].status){var c=e[a].status.self.self;n=r.a.createElement("span",{className:"text-uppercase "+c.format.class},g)}if("temp"in e[a].status)for(var u in e[a].status.temp){var p=e[a].status.temp[u];i[u]=r.a.createElement("div",{key:u,className:"device-ins-block-small "+p.format.class,title:p.format.title},p.format.title)}if("ins"in e[a].status)for(var d in e[a].status.ins){var m=e[a].status.ins[d];s.push(r.a.createElement("div",{key:d,className:"device-ins-block-small "+m.format.class,title:m.format.title},m.format.caption))}if("couts"in e[a].status)for(var h in e[a].status.couts){var v=e[a].status.couts[h];o.push(r.a.createElement("div",{key:h,className:"device-ins-block-small "+v.format.class,title:v.format.title},v.format.caption))}if("misc"in e[a].status)for(var E in e[a].status.misc){var w=e[a].status.misc[E];l.push(r.a.createElement("div",{key:E,className:"device-ins-block-small "+w.format.class,title:w.format.title},w.format.caption))}t.push(r.a.createElement("tr",{key:e[a].id,className:"tr-device"},r.a.createElement("td",null,n),r.a.createElement("td",null,e[a].name),r.a.createElement("td",null,r.a.createElement("small",null,e[a].client_name)),r.a.createElement("td",null,e[a].address),r.a.createElement("td",null,i.ext),r.a.createElement("td",null,i.cpu),r.a.createElement("td",null,r.a.createElement(f.a,{to:"/monitoring/device/"+e[a].id},"Управление")))),t.push(r.a.createElement("tr",{key:"info_"+e[a].id,className:"tr-device-info"},r.a.createElement("td",{colSpan:"7"},s," ",o," ",l)))}}var N="";"title"in this.state.data&&(N=this.state.data.title);var x=[{title:"обновить",ico:"ti-reload",onClick:this.updateList}],O=[];return"clients"in this.props.appSettings&&(O=this.props.appSettings.clients),r.a.createElement("div",{className:"page-content container-fluid"},r.a.createElement("div",{className:"row"},r.a.createElement(y,{title:N,buttons:x,col:"col-md-12"},r.a.createElement("div",{className:"mb-12"},this.state.data.client_choice&&r.a.createElement(b,{list:O,value:this.state.clientId,style:{width:"150px",display:"inline-block",marginLeft:"1em"},onChange:this.handleChange("clientId"),label:"Клиент"})),r.a.createElement("table",{className:"table"},_,r.a.createElement("tbody",null,t)))))},e}(r.a.Component),N=Object(c.b)(function(t){return{appSettings:t.appSettings}})(w);var x=r.a.createElement("button",{type:"button",className:"close","data-dismiss":"modal","aria-label":"Close"},r.a.createElement("span",{"aria-hidden":"true"},"×")),O=r.a.createElement("span",null,"Нет данных для отображения"),S=r.a.createElement("button",{type:"button",className:"btn btn-secondary","data-dismiss":"modal"},"Закрыть"),k=function(t){function e(a){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,a));return n.state={chartStyle:{minWidth:"310px",height:"500px",margin:"0 auto"}},n.chart=null,n.chartBox=r.a.createRef(),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.componentWillUnmount=function(){this.chart&&(this.chart.destroy(),this.chart=null)},e.prototype.render=function(){var t=this.props.data.data||[];if(this.chart&&(this.chart.destroy(),this.chart=null),this.chartBox.current&&t.length){var e={};switch(this.props.data.chartType){case"area":e={type:"area",plotOptions:{area:{stacking:"normal",step:"left"}},data:t};break;default:e={type:"spline",plotOptions:{line:{dataLabels:{enabled:!1},enableMouseTracking:!0}},data:t}}this.chart=Highcharts.chart(this.props.id+"__chart",{chart:{type:e.type,zoomType:"x"},title:{text:this.props.data.title},subtitle:{text:this.props.data.subtitle},legend:{enabled:!1},xAxis:{type:"datetime",labels:{format:"{value:%Y-%m-%e %H:%M:%S}",rotation:-90}},yAxis:{title:{text:"Значение"}},plotOptions:e.plotOptions,series:[{name:"["+this.props.data.unit_code+"] "+this.props.data.title,data:e.data}],time:{timezoneOffset:-180}})}return r.a.createElement("div",{className:"modal fade",id:this.props.id,tabIndex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},r.a.createElement("div",{className:"modal-dialog modal-lg",role:"document"},r.a.createElement("div",{className:"modal-content"},r.a.createElement("div",{className:"modal-header"},r.a.createElement("h5",{className:"modal-title"},this.props.title),x),r.a.createElement("div",{className:"modal-body"},this.props.children,0===t.length&&O,r.a.createElement("div",{id:this.props.id+"__chart",style:this.state.chartStyle,ref:this.chartBox})),r.a.createElement("div",{className:"modal-footer"},S))))},e}(r.a.Component);Number.defaultProps={className:"form-control",id:"modal_1",title:"",data:[]};var C=k;var T=r.a.createElement("div",null,"Error!"),j=r.a.createElement("i",{className:"ti-bar-chart"}),P=r.a.createElement("i",{className:"ti-bar-chart"}),I=r.a.createElement("i",{className:"ti-power-off"}),L=r.a.createElement("i",{className:"ti-bar-chart"}),M=r.a.createElement("i",{className:"ti-power-off"}),R=r.a.createElement("i",{className:"ti-light-bulb"}),U=r.a.createElement("i",{className:"c-orange-500 ti-home"}),D=r.a.createElement("div",{className:"col-md-4"},r.a.createElement(y,{title:"Температура"},temps)),B=r.a.createElement("div",null),A=function(t){function e(a){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,a));return n.state={data:{},timer:0,modal:{}},n.handleChange=n.handleChange.bind(n),n.updateList=n.updateList.bind(n),n.chartShow=n.chartShow.bind(n),n.unitToggle=n.unitToggle.bind(n),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.componentDidMount=function(){this.updateList();var t=setInterval(this.updateList,updateInterval);this.setState({timer:t})},e.prototype.componentWillUnmount=function(){clearTimeout(this.state.timer),this.setState({timer:null})},e.prototype.handleChange=function(t,e){var a;this.setState(((a={})[t]=e,a))},e.prototype.updateList=function(){var t=this;h.get({url:"/monitoring/api",data:{action:"device_info",device_id:this.props.match.params.id},success:function(e){t.setState({data:e.data})}})},e.prototype.chartShow=function(t,e,a){var n=this;this.setState({modal:{}}),h.get({url:"/monitoring/api",data:{action:"chart",device_id:t,unit_id:e,chart_type:a},success:function(t){var e={device:t.data.unit.device,title:t.data.unit.title,subtitle:"",code:t.data.unit.name,chartType:a,data:t.data.data};n.setState({modal:e})}}),$("#modal_chart").modal()},e.prototype.unitToggle=function(t){h.get({url:"/monitoring/api",data:{action:"unit_toggle",unit_id:t},success:function(t){console.log(t.data)}})},e.prototype.render=function(){var t;if(!("data"in this.state.data))return T;var e="";"title"in this.state.data&&(e=this.state.data.title);var a=[(t={title:""},t.title="обновить",t.ico="ti-reload",t.onClick=this.updateList,t)],n=[],i=[],s=[],o=null;if("data"in this.state.data){if("temp"in this.state.data.data.status)for(var l in this.state.data.data.status.temp){var c=this.state.data.data.status.temp[l],u=null;c.format.chart&&(u=r.a.createElement("span",{className:"float-right cur-p",onClick:this.chartShow(this.state.data.data.id,c.id,c.format.chart)},j)),n.push(r.a.createElement("div",{key:l,className:"p-20 mb-4 "+c.format.class},r.a.createElement("h6",null,c.format.title," ",u),r.a.createElement("div",null,r.a.createElement("h1",{className:"text-center"},c.format.caption),r.a.createElement("div",{className:"text-right"},c.timestamp))))}if("ins"in this.state.data.data.status)for(var p in this.state.data.data.status.ins){var d=this.state.data.data.status.ins[p],m=null;d.format.chart&&(m=r.a.createElement("span",{className:"float-right cur-p",onClick:this.chartShow(this.state.data.data.id,d.id,d.format.chart)},P));var h=null;"toggle"===(d.format.control||null)&&(h=r.a.createElement("span",{className:"float-left btn-toggle",onClick:this.unitToggle(d.id)},I)),i.push(r.a.createElement("div",{key:p,className:"device-ins-block"},r.a.createElement("div",{className:"p-10 "+d.format.class},r.a.createElement("h6",null,d.format.title," ",m),r.a.createElement("div",null,r.a.createElement("h4",{className:"text-center"},d.format.caption),r.a.createElement("div",{className:"text-right"},h," ",d.timestamp)))))}if("couts"in this.state.data.data.status)for(var f in this.state.data.data.status.couts){var v=this.state.data.data.status.couts[f],b=null;v.format.chart&&(b=r.a.createElement("span",{className:"float-right cur-p",onClick:this.chartShow(this.state.data.data.id,v.unit,v.format.chart)},L));var E=null;"toggle"===(v.format.control||null)&&(E=r.a.createElement("span",{className:"float-left btn-toggle",onClick:this.unitToggle(v.id)},M)),s.push(r.a.createElement("div",{key:f,className:"device-ins-block"},r.a.createElement("div",{className:"p-10 "+v.format.class},r.a.createElement("h6",null,v.format.title," ",b),r.a.createElement("div",null,r.a.createElement("h4",{className:"text-center"},v.format.caption),r.a.createElement("div",{className:"text-right"},E," ",v.timestamp)))))}if("self"in this.state.data.data.status&&"self"in this.state.data.data.status.self){var g=this.state.data.data.status.self.self,_=R;o=r.a.createElement("span",{className:"text-uppercase "+g.format.class},_," ",g.timestamp," ",g.format.caption)}}return r.a.createElement("div",{className:"page-content container-fluid"},r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-md-8"},r.a.createElement(y,{title:e,buttons:a},r.a.createElement("div",null,U,this.state.data.data.address),r.a.createElement("div",null,o)),r.a.createElement(y,{title:"Датчики"},r.a.createElement("div",null,i),r.a.createElement("div",null,s))),D),r.a.createElement(C,{id:"modal-chart",title:this.state.modal.device,data:this.state.modal},B))},e}(r.a.Component),W=Object(c.b)(function(t){return{appSettings:t.appSettings}})(A);h.get({url:"/monitoring/api",data:{action:"get_settings",all:"Все",group_id:1},success:function(t){u.a.dispatch({type:"settings",data:t.data})}});var F=r.a.createElement(s.a,{exact:!0,path:"/monitoring/",component:N}),J=r.a.createElement(s.a,{exact:!0,path:"/monitoring/device/:id",component:W}),q=r.a.createElement("div",null,"404"),K=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.apply(this,arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.render=function(){return r.a.createElement(c.a,{store:u.a},r.a.createElement(o.a,null,r.a.createElement("div",{className:"body"},r.a.createElement(l.a,null,F,J,r.a.createElement(s.a,{path:"*",render:function(){return q}})))))},e}(n.Component);Object(i.render)(r.a.createElement(K,null),document.querySelector("#reactApp"))}},[[28,2,1]]]);
//# sourceMappingURL=app.14ca215c.js.map